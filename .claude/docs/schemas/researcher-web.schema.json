{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Researcher-Web Agent Schema",
  "description": "Schema for researcher-web agent outputs - web and documentation research worker",
  "version": "1.0.0",
  "allOf": [
    {
      "$ref": "./base-agent.schema.json"
    }
  ],
  "properties": {
    "output": {
      "type": "object",
      "oneOf": [
        {
          "title": "Success Output",
          "properties": {
            "status": { "const": "SUCCESS" },
            "agent": { "const": "researcher-web" },
            "task_id": { "type": "string" },
            "operation_type": {
              "type": "string",
              "enum": ["web_research", "documentation_analysis", "best_practice_discovery", "framework_research", "security_research"]
            },
            "summary": { "type": "string" },
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "execution_timestamp": {
              "type": "string",
              "format": "date-time"
            },
            "agent_specific_output": {
              "type": "object",
              "properties": {
                "findings": {
                  "type": "object",
                  "properties": {
                    "key_patterns": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "pattern": { "type": "string" },
                          "description": { "type": "string" },
                          "confidence": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1
                          },
                          "sources": {
                            "type": "array",
                            "items": { "type": "string", "format": "uri" }
                          },
                          "example": { "type": "string" },
                          "applicability": { "type": "string" }
                        },
                        "required": ["pattern", "description", "confidence", "sources"]
                      }
                    },
                    "compressed_synthesis": {
                      "type": "string",
                      "description": "Dense summary of all findings"
                    }
                  },
                  "required": ["key_patterns", "compressed_synthesis"]
                },
                "source_attribution": {
                  "type": "object",
                  "properties": {
                    "authoritative": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "url": { "type": "string", "format": "uri" },
                          "title": { "type": "string" },
                          "accessed_date": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "quality_score": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1
                          }
                        },
                        "required": ["url", "title", "quality_score"]
                      }
                    },
                    "supporting": {
                      "type": "array",
                      "items": { "type": "string", "format": "uri" }
                    },
                    "rejected": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "url": { "type": "string", "format": "uri" },
                          "reason": { "type": "string" }
                        },
                        "required": ["url", "reason"]
                      }
                    }
                  },
                  "required": ["authoritative"]
                },
                "compression_stats": {
                  "type": "object",
                  "properties": {
                    "sources_evaluated": { "type": "integer", "minimum": 0 },
                    "authoritative_used": { "type": "integer", "minimum": 0 },
                    "patterns_extracted": { "type": "integer", "minimum": 0 },
                    "compression_ratio": { "type": "string" }
                  },
                  "required": ["sources_evaluated", "authoritative_used", "patterns_extracted", "compression_ratio"]
                },
                "research_boundaries": {
                  "type": "object",
                  "properties": {
                    "termination_reason": {
                      "type": "string",
                      "enum": ["target_patterns_found", "tool_budget_exhausted", "diminishing_returns", "confidence_threshold_met"]
                    },
                    "gaps": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  },
                  "required": ["termination_reason"]
                },
                "security_validations": {
                  "type": "object",
                  "properties": {
                    "urls_validated": { "type": "integer", "minimum": 0 },
                    "ssrf_checks_passed": { "type": "integer", "minimum": 0 },
                    "content_sanitized": { "type": "boolean" },
                    "secrets_detected": { "type": "boolean" }
                  },
                  "required": ["urls_validated", "ssrf_checks_passed", "content_sanitized", "secrets_detected"]
                },
                "iteration_support": {
                  "type": "object",
                  "description": "Support for orchestrator-driven iterative research when initial findings are incomplete",
                  "properties": {
                    "open_questions": {
                      "type": "array",
                      "description": "Questions that remain unanswered after research, triggering potential follow-up",
                      "items": {
                        "type": "object",
                        "properties": {
                          "question": {
                            "type": "string",
                            "description": "Specific unanswered question"
                          },
                          "context": {
                            "type": "string",
                            "description": "Why this question arose and what was found"
                          },
                          "priority": {
                            "type": "string",
                            "enum": ["high", "medium", "low"],
                            "description": "Importance for understanding the topic"
                          },
                          "suggested_approach": {
                            "type": "string",
                            "description": "How to research this (e.g., 'researcher-library for official docs')"
                          }
                        },
                        "required": ["question", "context", "priority"]
                      }
                    },
                    "confidence_breakdown": {
                      "type": "object",
                      "description": "Detailed confidence analysis for iteration decisions",
                      "properties": {
                        "overall_confidence": {
                          "type": "number",
                          "minimum": 0.0,
                          "maximum": 1.0,
                          "description": "Overall confidence in findings"
                        },
                        "confidence_factors": {
                          "type": "object",
                          "properties": {
                            "source_quality": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
                            "coverage_completeness": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
                            "pattern_consensus": { "type": "number", "minimum": 0.0, "maximum": 1.0 }
                          }
                        },
                        "low_confidence_rationale": {
                          "type": "array",
                          "description": "Reasons for confidence below 0.85 threshold",
                          "items": { "type": "string" }
                        },
                        "confidence_improvement_actions": {
                          "type": "array",
                          "description": "Specific steps to increase confidence",
                          "items": { "type": "string" }
                        }
                      },
                      "required": ["overall_confidence"]
                    }
                  }
                }
              },
              "required": ["findings", "source_attribution", "compression_stats", "research_boundaries", "security_validations"]
            }
          },
          "required": ["status", "agent", "confidence", "agent_specific_output"]
        },
        {
          "title": "Failure Output",
          "properties": {
            "status": { "const": "FAILURE" },
            "agent": { "const": "researcher-web" },
            "task_id": { "type": "string" },
            "operation_type": {
              "type": "string",
              "enum": ["web_research", "documentation_analysis", "best_practice_discovery", "framework_research", "security_research"]
            },
            "summary": { "type": "string" },
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "execution_timestamp": {
              "type": "string",
              "format": "date-time"
            },
            "failure_details": {
              "type": "object",
              "properties": {
                "failure_type": {
                  "type": "string",
                  "enum": ["insufficient_sources", "search_quota_exceeded", "fetch_failures", "validation_error", "ssrf_blocked", "content_sanitization_failed"]
                },
                "reasons": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "research_attempted": {
                  "type": "object",
                  "properties": {
                    "web_searches": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "url_fetches": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "url": { "type": "string", "format": "uri" },
                          "error": { "type": "string" }
                        }
                      }
                    }
                  }
                },
                "partial_results": {
                  "type": "object",
                  "properties": {
                    "patterns_found": { "type": "integer", "minimum": 0 },
                    "sources_accessed": { "type": "integer", "minimum": 0 }
                  }
                },
                "recovery_suggestions": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "approach": { "type": "string" },
                      "rationale": { "type": "string" }
                    },
                    "required": ["approach", "rationale"]
                  }
                }
              },
              "required": ["failure_type", "reasons"]
            }
          },
          "required": ["status", "agent", "confidence", "failure_details"]
        }
      ]
    }
  }
}
