{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "researcher-library Agent Schema",
  "description": "Library documentation research specialist using Context7 MCP server",
  "version": "1.0.0",
  "extends": ".claude/docs/schemas/base-agent.schema.json",
  "type": "object",
  "properties": {
    "input": {
      "type": "object",
      "properties": {
        "context": {
          "type": "string",
          "description": "Research delegation from researcher-lead with 4-component structure"
        },
        "library_name": {
          "type": "string",
          "description": "Library or framework to research (e.g., 'Pydantic', 'FastAPI')"
        },
        "topic": {
          "type": "string",
          "description": "Specific research topic or question (2-4 words preferred)"
        },
        "token_budget": {
          "type": "number",
          "default": 5000,
          "description": "Token allocation for Context7 queries (2k=quick, 5k=standard, 8k=deep)"
        },
        "execution_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 UTC timestamp from orchestrator"
        }
      },
      "required": ["context", "library_name", "execution_timestamp"]
    },
    "output": {
      "type": "object",
      "oneOf": [
        {
          "title": "Success Output",
          "properties": {
            "status": { "const": "SUCCESS" },
            "agent": { "const": "researcher-library" },
            "confidence": {
              "type": "number",
              "minimum": 0.70,
              "maximum": 1.0,
              "description": "Target â‰¥0.90 for authoritative documentation"
            },
            "execution_timestamp": {
              "type": "string",
              "format": "date-time"
            },
            "agent_specific_output": {
              "type": "object",
              "properties": {
                "findings": {
                  "type": "object",
                  "properties": {
                    "library_info": {
                      "type": "object",
                      "properties": {
                        "library_id": { "type": "string" },
                        "version": { "type": "string" },
                        "trust_score": { "type": "number", "minimum": 0, "maximum": 10 },
                        "snippet_count": { "type": "number" }
                      },
                      "required": ["library_id", "trust_score"]
                    },
                    "api_signatures": {
                      "type": "array",
                      "items": { "type": "string" },
                      "description": "Type-annotated function/method signatures"
                    },
                    "key_patterns": {
                      "type": "array",
                      "items": { "type": "string" },
                      "description": "Implementation patterns and best practices"
                    },
                    "code_examples": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "description": { "type": "string" },
                          "code": { "type": "string" },
                          "source": { "type": "string" }
                        },
                        "required": ["description", "code", "source"]
                      }
                    },
                    "version_notes": {
                      "type": "array",
                      "items": { "type": "string" },
                      "description": "Breaking changes, deprecations, version-specific features"
                    }
                  },
                  "required": ["library_info", "api_signatures", "key_patterns"]
                },
                "compression_stats": {
                  "type": "object",
                  "properties": {
                    "tokens_retrieved": { "type": "number" },
                    "findings_returned": { "type": "number" },
                    "compression_ratio": { "type": "string", "pattern": "^\\d+:1$" }
                  },
                  "required": ["tokens_retrieved", "findings_returned", "compression_ratio"],
                  "description": "Target compression ratio: 15:1 minimum"
                },
                "context7_performance": {
                  "type": "object",
                  "properties": {
                    "query_count": { "type": "number" },
                    "total_duration_seconds": { "type": "number", "maximum": 15 },
                    "queries": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "round": { "type": "number" },
                          "tool": { "type": "string" },
                          "tokens_requested": { "type": "number" },
                          "tokens_returned": { "type": "number" },
                          "duration_seconds": { "type": "number" }
                        }
                      }
                    }
                  },
                  "required": ["query_count", "total_duration_seconds"],
                  "description": "Performance target: <15 seconds total"
                },
                "research_boundaries": {
                  "type": "object",
                  "properties": {
                    "termination_reason": {
                      "type": "string",
                      "enum": ["found_sufficient", "quality_threshold", "token_limit", "iteration_limit"]
                    },
                    "topic_coverage": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "gaps": {
                      "type": "array",
                      "items": { "type": "string" },
                      "description": "Topics not covered, may need researcher-web"
                    }
                  },
                  "required": ["termination_reason"]
                },
                "iteration_support": {
                  "type": "object",
                  "description": "Support for orchestrator-driven iterative research when library documentation is incomplete",
                  "properties": {
                    "open_questions": {
                      "type": "array",
                      "description": "Library/framework questions that remain unanswered from official docs",
                      "items": {
                        "type": "object",
                        "properties": {
                          "question": {
                            "type": "string",
                            "description": "Specific unanswered question about library usage or behavior"
                          },
                          "context": {
                            "type": "string",
                            "description": "What was found in official docs and what's still unclear"
                          },
                          "priority": {
                            "type": "string",
                            "enum": ["high", "medium", "low"],
                            "description": "Importance for using the library correctly"
                          },
                          "suggested_approach": {
                            "type": "string",
                            "description": "How to research this (e.g., 'researcher-web for community examples')"
                          }
                        },
                        "required": ["question", "context", "priority"]
                      }
                    },
                    "confidence_breakdown": {
                      "type": "object",
                      "description": "Detailed confidence analysis for iteration decisions",
                      "properties": {
                        "overall_confidence": {
                          "type": "number",
                          "minimum": 0.0,
                          "maximum": 1.0,
                          "description": "Overall confidence in library documentation findings"
                        },
                        "confidence_factors": {
                          "type": "object",
                          "properties": {
                            "documentation_completeness": {"type": "number", "minimum": 0.0, "maximum": 1.0},
                            "version_accuracy": {"type": "number", "minimum": 0.0, "maximum": 1.0},
                            "example_quality": {"type": "number", "minimum": 0.0, "maximum": 1.0}
                          }
                        },
                        "low_confidence_rationale": {
                          "type": "array",
                          "description": "Reasons for confidence below 0.85 threshold",
                          "items": {"type": "string"}
                        },
                        "confidence_improvement_actions": {
                          "type": "array",
                          "description": "Specific steps to increase confidence in library understanding",
                          "items": {"type": "string"}
                        }
                      },
                      "required": ["overall_confidence"]
                    }
                  }
                }
              },
              "required": ["findings", "compression_stats", "context7_performance", "research_boundaries"]
            }
          },
          "required": ["status", "agent", "confidence", "execution_timestamp", "agent_specific_output"]
        },
        {
          "title": "Failure Output",
          "properties": {
            "status": { "const": "FAILURE" },
            "agent": { "const": "researcher-library" },
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1.0
            },
            "execution_timestamp": {
              "type": "string",
              "format": "date-time"
            },
            "failure_details": {
              "type": "object",
              "properties": {
                "failure_type": {
                  "type": "string",
                  "enum": [
                    "library_not_found",
                    "insufficient_coverage",
                    "version_mismatch",
                    "quality_threshold_not_met",
                    "context7_unavailable"
                  ]
                },
                "reasons": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "research_attempted": {
                  "type": "object",
                  "properties": {
                    "resolve_queries": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "libraries_found": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "tokens_used": { "type": "number" }
                  }
                },
                "partial_results": {
                  "type": ["object", "null"],
                  "description": "Partial findings if any were gathered before failure"
                },
                "recovery_suggestions": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "approach": { "type": "string" },
                      "rationale": { "type": "string" },
                      "delegation": {
                        "type": "object",
                        "properties": {
                          "worker_type": { "type": "string" },
                          "query_refinement": { "type": "string" }
                        }
                      }
                    },
                    "required": ["approach", "rationale"]
                  }
                }
              },
              "required": ["failure_type", "reasons", "recovery_suggestions"]
            }
          },
          "required": ["status", "agent", "confidence", "execution_timestamp", "failure_details"]
        }
      ]
    }
  },
  "required": ["input", "output"]
}
