{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Prompt Evaluator Agent Schema",
  "description": "Input/output schema for prompt-evaluator agent with comprehensive evaluation dimensions",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "input": {
      "type": "object",
      "description": "Input schema for agent evaluation requests",
      "properties": {
        "context": {
          "type": "string",
          "description": "Primary task context and evaluation instructions"
        },
        "agent_file_path": {
          "type": "string",
          "description": "Absolute path to agent markdown file (required)"
        },
        "schema_file_path": {
          "type": "string",
          "description": "Absolute path to agent-specific schema (optional, falls back to base-agent.schema.json)"
        },
        "evaluation_focus": {
          "type": "string",
          "enum": ["all", "prompt-engineering", "tokens", "testing", "structural"],
          "default": "all",
          "description": "Focus area for evaluation (all dimensions or specific dimension)"
        },
        "execution_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 UTC timestamp from orchestrator (mandatory)"
        }
      },
      "required": ["context", "agent_file_path", "execution_timestamp"]
    },
    "output": {
      "type": "object",
      "oneOf": [
        {
          "title": "Success Output",
          "properties": {
            "status": { "const": "SUCCESS" },
            "agent": { "const": "prompt-evaluator" },
            "task_id": {
              "type": "string",
              "description": "Unique task identifier"
            },
            "operation_type": {
              "const": "evaluate_agent",
              "description": "Operation performed"
            },
            "summary": {
              "type": "string",
              "description": "1-3 sentence executive summary of evaluation results"
            },
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Overall confidence in evaluation accuracy"
            },
            "execution_timestamp": {
              "type": "string",
              "format": "date-time",
              "description": "ISO 8601 UTC timestamp from orchestrator"
            },
            "agent_specific_output": {
              "type": "object",
              "description": "Comprehensive evaluation results",
              "properties": {
                "evaluation_summary": {
                  "type": "object",
                  "description": "High-level evaluation summary",
                  "properties": {
                    "agent_name": {
                      "type": "string",
                      "description": "Name of evaluated agent"
                    },
                    "agent_version": {
                      "type": "string",
                      "description": "Maturity version (v0.x, v1.x, etc.)"
                    },
                    "maturity_level": {
                      "type": "string",
                      "enum": ["v0.x-MVP", "v1.x-Alpha", "v2.x-Beta", "v3.x-GA"],
                      "description": "Agent maturity stage"
                    },
                    "overall_grade": {
                      "type": "string",
                      "enum": ["A", "B", "C", "D", "F"],
                      "description": "Overall quality grade"
                    },
                    "risk_level": {
                      "type": "string",
                      "enum": ["CRITICAL", "HIGH", "MEDIUM", "LOW"],
                      "description": "Risk level based on tools and operations"
                    },
                    "agent_type": {
                      "type": "string",
                      "enum": ["Manager", "Creator", "Reviewer", "Worker", "Analyzer", "Fixer", "Improver"],
                      "description": "Agent classification"
                    },
                    "evaluation_timestamp": {
                      "type": "string",
                      "format": "date-time",
                      "description": "ISO 8601 timestamp of evaluation"
                    }
                  },
                  "required": ["agent_name", "overall_grade", "risk_level", "evaluation_timestamp"]
                },
                "structural_quality": {
                  "type": "object",
                  "description": "Structural quality assessment (15 criteria)",
                  "properties": {
                    "score": {
                      "type": "string",
                      "pattern": "^\\d{1,2}/15$",
                      "description": "Score out of 15 (e.g., '12/15')"
                    },
                    "percentage": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 100,
                      "description": "Score as percentage"
                    },
                    "passing_criteria": {
                      "type": "array",
                      "description": "List of passing criteria with evidence",
                      "items": {
                        "type": "object",
                        "properties": {
                          "criterion": {
                            "type": "string",
                            "description": "Name of criterion"
                          },
                          "evidence": {
                            "type": "string",
                            "description": "File:line citation supporting pass"
                          }
                        },
                        "required": ["criterion", "evidence"]
                      }
                    },
                    "failing_criteria": {
                      "type": "array",
                      "description": "List of failing criteria with evidence and fix guidance",
                      "items": {
                        "type": "object",
                        "properties": {
                          "criterion": {
                            "type": "string",
                            "description": "Name of criterion"
                          },
                          "evidence": {
                            "type": "string",
                            "description": "File:line citation showing failure"
                          },
                          "fix_guidance": {
                            "type": "string",
                            "description": "Specific guidance for addressing failure"
                          }
                        },
                        "required": ["criterion", "evidence", "fix_guidance"]
                      }
                    }
                  },
                  "required": ["score", "percentage", "passing_criteria", "failing_criteria"]
                },
                "prompt_engineering_quality": {
                  "type": "object",
                  "description": "Anthropic prompt engineering assessment (9 principles)",
                  "properties": {
                    "score": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 9,
                      "description": "Raw score out of 9 principles"
                    },
                    "grade": {
                      "type": "string",
                      "enum": ["A", "B", "C", "D", "F"],
                      "description": "Letter grade based on weighted average"
                    },
                    "principle_scores": {
                      "type": "array",
                      "description": "Individual principle assessments",
                      "items": {
                        "type": "object",
                        "properties": {
                          "principle": {
                            "type": "string",
                            "description": "Principle name"
                          },
                          "score": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 5,
                            "description": "Score (0-5 scale)"
                          },
                          "evidence": {
                            "type": "string",
                            "description": "Supporting evidence or gap description"
                          }
                        },
                        "required": ["principle", "score", "evidence"]
                      },
                      "minItems": 9,
                      "maxItems": 9
                    },
                    "strengths": {
                      "type": "array",
                      "description": "List of prompt engineering strengths",
                      "items": {
                        "type": "string"
                      }
                    },
                    "weaknesses": {
                      "type": "array",
                      "description": "List of weaknesses with improvement suggestions",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": ["score", "grade", "principle_scores", "strengths", "weaknesses"]
                },
                "token_optimization": {
                  "type": "object",
                  "description": "Token optimization analysis",
                  "properties": {
                    "current_tokens": {
                      "type": "number",
                      "description": "Estimated current token count"
                    },
                    "optimization_potential": {
                      "type": "number",
                      "description": "Total potential token savings"
                    },
                    "optimization_percentage": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 100,
                      "description": "Optimization potential as percentage"
                    },
                    "priority_optimizations": {
                      "type": "array",
                      "description": "Prioritized optimization techniques",
                      "items": {
                        "type": "object",
                        "properties": {
                          "technique": {
                            "type": "string",
                            "description": "Optimization technique name"
                          },
                          "savings": {
                            "type": "number",
                            "description": "Token savings potential"
                          },
                          "effort": {
                            "type": "string",
                            "enum": ["low", "medium", "high"],
                            "description": "Implementation effort estimate"
                          },
                          "priority_score": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "description": "Priority score (savings × effort⁻¹)"
                          },
                          "implementation": {
                            "type": "string",
                            "description": "Specific implementation guidance"
                          }
                        },
                        "required": ["technique", "savings", "effort", "implementation"]
                      }
                    }
                  },
                  "required": ["current_tokens", "optimization_potential", "optimization_percentage", "priority_optimizations"]
                },
                "testing_strategy": {
                  "type": "object",
                  "description": "Testing strategy assessment",
                  "properties": {
                    "current_approach": {
                      "type": "string",
                      "description": "Description of current testing approach"
                    },
                    "required_approach": {
                      "type": "string",
                      "description": "Required testing approach based on risk level"
                    },
                    "gaps": {
                      "type": "array",
                      "description": "Testing gaps identified",
                      "items": {
                        "type": "string"
                      }
                    },
                    "recommended_actions": {
                      "type": "array",
                      "description": "Recommended testing actions",
                      "items": {
                        "type": "object",
                        "properties": {
                          "action": {
                            "type": "string",
                            "description": "Specific testing action"
                          },
                          "priority": {
                            "type": "string",
                            "enum": ["critical", "major", "minor"],
                            "description": "Action priority"
                          },
                          "framework": {
                            "type": "string",
                            "description": "Recommended testing framework"
                          }
                        },
                        "required": ["action", "priority"]
                      }
                    }
                  },
                  "required": ["current_approach", "required_approach", "gaps", "recommended_actions"]
                },
                "issues": {
                  "type": "object",
                  "description": "Issues classified by severity",
                  "properties": {
                    "critical": {
                      "type": "array",
                      "description": "Critical issues blocking production",
                      "items": {
                        "type": "object",
                        "properties": {
                          "issue": {
                            "type": "string",
                            "description": "Issue description"
                          },
                          "evidence": {
                            "type": "string",
                            "description": "File:line citation"
                          },
                          "fix_guidance": {
                            "type": "string",
                            "description": "Specific fix guidance"
                          },
                          "priority_score": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "description": "Calculated priority score"
                          }
                        },
                        "required": ["issue", "evidence", "fix_guidance"]
                      }
                    },
                    "major": {
                      "type": "array",
                      "description": "Major issues degrading quality",
                      "items": {
                        "type": "object",
                        "properties": {
                          "issue": {
                            "type": "string",
                            "description": "Issue description"
                          },
                          "evidence": {
                            "type": "string",
                            "description": "File:line citation"
                          },
                          "fix_guidance": {
                            "type": "string",
                            "description": "Specific fix guidance"
                          },
                          "priority_score": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "description": "Calculated priority score"
                          }
                        },
                        "required": ["issue", "evidence", "fix_guidance"]
                      }
                    },
                    "minor": {
                      "type": "array",
                      "description": "Minor issues for polish",
                      "items": {
                        "type": "object",
                        "properties": {
                          "issue": {
                            "type": "string",
                            "description": "Issue description"
                          },
                          "evidence": {
                            "type": "string",
                            "description": "File:line citation"
                          },
                          "fix_guidance": {
                            "type": "string",
                            "description": "Specific fix guidance"
                          },
                          "priority_score": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "description": "Calculated priority score"
                          }
                        },
                        "required": ["issue", "evidence", "fix_guidance"]
                      }
                    }
                  },
                  "required": ["critical", "major", "minor"]
                },
                "recommended_improvements": {
                  "type": "object",
                  "description": "Prioritized improvement roadmap",
                  "properties": {
                    "immediate_actions": {
                      "type": "array",
                      "description": "Top 3 actions by priority score",
                      "items": {
                        "type": "object",
                        "properties": {
                          "action": {
                            "type": "string",
                            "description": "Action description"
                          },
                          "rationale": {
                            "type": "string",
                            "description": "Why this is immediate priority"
                          },
                          "impact": {
                            "type": "string",
                            "description": "Expected impact"
                          },
                          "priority_score": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "description": "Calculated priority"
                          }
                        },
                        "required": ["action", "rationale", "impact"]
                      },
                      "maxItems": 3
                    },
                    "short_term_actions": {
                      "type": "array",
                      "description": "Actions 4-10 by priority score",
                      "items": {
                        "type": "object",
                        "properties": {
                          "action": {
                            "type": "string",
                            "description": "Action description"
                          },
                          "rationale": {
                            "type": "string",
                            "description": "Why this is short-term priority"
                          },
                          "impact": {
                            "type": "string",
                            "description": "Expected impact"
                          },
                          "priority_score": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "description": "Calculated priority"
                          }
                        },
                        "required": ["action", "rationale", "impact"]
                      }
                    },
                    "long_term_optimizations": {
                      "type": "array",
                      "description": "Maintenance and polish items",
                      "items": {
                        "type": "object",
                        "properties": {
                          "action": {
                            "type": "string",
                            "description": "Action description"
                          },
                          "rationale": {
                            "type": "string",
                            "description": "Why this is long-term"
                          }
                        },
                        "required": ["action", "rationale"]
                      }
                    }
                  },
                  "required": ["immediate_actions", "short_term_actions", "long_term_optimizations"]
                },
                "anti_patterns_detected": {
                  "type": "array",
                  "description": "Detected anti-patterns with severity",
                  "items": {
                    "type": "object",
                    "properties": {
                      "pattern": {
                        "type": "string",
                        "description": "Anti-pattern name"
                      },
                      "severity": {
                        "type": "string",
                        "enum": ["critical", "major", "minor"],
                        "description": "Anti-pattern severity"
                      },
                      "locations": {
                        "type": "array",
                        "description": "File:line references where detected",
                        "items": {
                          "type": "string"
                        }
                      },
                      "fix": {
                        "type": "string",
                        "description": "Specific fix guidance"
                      }
                    },
                    "required": ["pattern", "severity", "locations", "fix"]
                  }
                },
                "confidence_scores": {
                  "type": "object",
                  "description": "Confidence scores per evaluation dimension",
                  "properties": {
                    "structural_evaluation": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1,
                      "description": "Confidence in structural assessment"
                    },
                    "prompt_engineering": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1,
                      "description": "Confidence in prompt engineering grading"
                    },
                    "token_analysis": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1,
                      "description": "Confidence in token optimization calculations"
                    },
                    "testing_assessment": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1,
                      "description": "Confidence in testing strategy assessment"
                    },
                    "overall_confidence": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1,
                      "description": "Overall evaluation confidence"
                    }
                  },
                  "required": ["structural_evaluation", "prompt_engineering", "token_analysis", "testing_assessment", "overall_confidence"]
                }
              },
              "required": [
                "evaluation_summary",
                "structural_quality",
                "prompt_engineering_quality",
                "token_optimization",
                "testing_strategy",
                "issues",
                "recommended_improvements",
                "anti_patterns_detected",
                "confidence_scores"
              ]
            }
          },
          "required": ["status", "agent", "confidence", "agent_specific_output"],
          "additionalProperties": false
        },
        {
          "title": "Failure Output",
          "properties": {
            "status": { "const": "FAILURE" },
            "agent": { "const": "prompt-evaluator" },
            "task_id": {
              "type": "string",
              "description": "Unique task identifier"
            },
            "operation_type": {
              "const": "evaluate_agent",
              "description": "Operation attempted"
            },
            "summary": {
              "type": "string",
              "description": "1-3 sentence summary of why evaluation failed"
            },
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Confidence in failure analysis"
            },
            "execution_timestamp": {
              "type": "string",
              "format": "date-time",
              "description": "ISO 8601 UTC timestamp from orchestrator"
            },
            "failure_details": {
              "type": "object",
              "description": "Failure information",
              "properties": {
                "failure_type": {
                  "type": "string",
                  "enum": [
                    "FILE_NOT_FOUND",
                    "FILE_UNREADABLE",
                    "INVALID_PATH",
                    "SCHEMA_MISSING",
                    "EVALUATION_INCOMPLETE",
                    "GUIDE_UNAVAILABLE"
                  ],
                  "description": "Primary failure type"
                },
                "reasons": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Specific reasons for failure"
                },
                "partial_results": {
                  "type": "object",
                  "description": "Any evaluation completed before failure",
                  "properties": {
                    "completed_dimensions": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": ["structural", "prompt-engineering", "tokens", "testing"]
                      },
                      "description": "Dimensions successfully evaluated"
                    },
                    "incomplete_dimensions": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": ["structural", "prompt-engineering", "tokens", "testing"]
                      },
                      "description": "Dimensions not evaluated"
                    }
                  }
                },
                "recovery_suggestions": {
                  "type": "array",
                  "description": "Suggested approaches to resolve failure",
                  "items": {
                    "type": "object",
                    "properties": {
                      "suggestion": {
                        "type": "string",
                        "description": "Recovery suggestion"
                      },
                      "effort": {
                        "type": "string",
                        "enum": ["low", "medium", "high"],
                        "description": "Effort required"
                      }
                    },
                    "required": ["suggestion", "effort"]
                  }
                }
              },
              "required": ["failure_type", "reasons"]
            }
          },
          "required": ["status", "agent", "confidence", "failure_details"],
          "additionalProperties": false
        }
      ]
    }
  },
  "required": ["input", "output"]
}
